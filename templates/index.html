<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Gujarat Planning Regulation Assistant</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <meta name="description" content="Expert AI assistant for Gujarat Planning Regulation Part II - Get instant answers about FSI, setbacks, building requirements">
    <meta name="theme-color" content="#667eea">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üèóÔ∏è</text></svg>">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèóÔ∏è Gujarat Planning Regulation Assistant</h1>
            <p>Official Gujarat Planning Regulation Part II - Expert AI Assistant</p>
        </div>

        <div class="chat-container">
            <div class="messages" id="messages">
                <div class="message bot">
                    <div class="message-avatar">ü§ñ</div>
                    <div class="message-content">
                        <strong>Welcome to Gujarat Planning Regulation Assistant!</strong><br><br>
                        I'm here to help you with questions about the <strong>NEW Gujarat-PART II PLANNING REGULATION</strong> document. I provide accurate answers based only on the official regulation content.<br><br>
                        <strong>Example Questions You Can Ask:</strong><br>
                        ‚Ä¢ What are the FSI requirements for residential buildings?<br>
                        ‚Ä¢ What is the minimum plot size for industrial development?<br>
                        ‚Ä¢ What are the setback requirements for commercial buildings?<br>
                        ‚Ä¢ What does Table 6.50 specify about building areas?<br>
                        ‚Ä¢ What are the height restrictions for different zones?<br>
                        ‚Ä¢ What are the parking requirements for different building types?<br><br>
                        <em>Ask me anything about Gujarat Planning Regulations!</em>
                    </div>
                </div>
            </div>

            <div class="loading" id="loading">
                <div class="loading-dots">üèóÔ∏è Analyzing Gujarat Planning Regulations...</div>
            </div>
        </div>

        <div class="input-container">
            <input type="text" id="questionInput" class="input-field" placeholder="Ask about Gujarat Planning Regulations..." onkeypress="handleKeyPress(event)" autocomplete="off">
            <button onclick="askQuestion()" class="send-button" id="sendButton">Send</button>
        </div>
    </div>

    <script>
        function addMessage(content, isUser = false) {
            const messagesContainer = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            
            // Format bot messages with basic markdown-like styling
            let formattedContent = content;
            if (!isUser) {
                // Convert markdown-like formatting to HTML
                formattedContent = content
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')  // Bold
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')              // Italic
                    .replace(/^### (.*$)/gm, '<h4>$1</h4>')           // H4 headers
                    .replace(/^## (.*$)/gm, '<h3>$1</h3>')            // H3 headers
                    .replace(/^# (.*$)/gm, '<h2>$1</h2>')             // H2 headers
                    .replace(/^‚Ä¢ (.*$)/gm, '<li>$1</li>')             // Bullet points
                    .replace(/^\d+\. (.*$)/gm, '<li>$1</li>')         // Numbered lists
                    .replace(/---/g, '<hr>')                          // Horizontal rules
                    .replace(/\n\n/g, '<br><br>')                     // Double line breaks
                    .replace(/\n/g, '<br>');                          // Single line breaks
                
                // Wrap consecutive <li> elements in <ul>
                formattedContent = formattedContent.replace(/(<li>.*?<\/li>)(\s*<li>.*?<\/li>)*/g, '<ul>$&</ul>');
            }
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${isUser ? 'üßë' : 'ü§ñ'}</div>
                <div class="message-content">
                    ${formattedContent}
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
            document.getElementById('sendButton').disabled = show;
        }

        async function askQuestion() {
            const input = document.getElementById('questionInput');
            const question = input.value.trim();
            
            if (!question) return;
            
            // Add user message
            addMessage(question, true);
            input.value = '';
            
            // Show loading
            showLoading(true);
            
            try {
                const response = await fetch('/ask', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ question: question })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    addMessage(data.answer, false);
                } else {
                    addMessage(`‚ùå Error: ${data.error}`, false);
                }
            } catch (error) {
                addMessage('‚ùå Network error. Please try again.', false);
            } finally {
                showLoading(false);
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                askQuestion();
            }
        }

        // Focus on input when page loads
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('questionInput').focus();
        });

        // Auto-resize for mobile keyboards
        window.addEventListener('resize', function() {
            const messages = document.getElementById('messages');
            messages.scrollTop = messages.scrollHeight;
        });

        // Prevent zoom on iOS
        document.addEventListener('touchstart', function(event) {
            if (event.touches.length > 1) {
                event.preventDefault();
            }
        });
    </script>
</body>
</html>